##########################################################################
# Tyranny of the Majority Events
# by Lucas Pinheiro Silva
##########################################################################

namespace = tyranny_majority

### Compare the Socialism-Capitalism axis

country_event = {
  id = tyranny_majority.500

  is_triggered_only = yes
  hide_window = yes

  immediate = {
    set_variable = {
      which = pops_fanatic_socialism
      value = 0
    }
    set_variable = {
      which = pops_socialism
      value = 0
    }
    set_variable = {
      which = total_socialisms
      value = 0
    }
    set_variable = {
      which = pops_capitalism
      value = 0
    }
    set_variable = {
      which = pops_fanatic_capitalism
      value = 0
    }
    set_variable = {
      which = total_capitalisms
      value = 0
    }
    set_variable = {
      which = pops_neutral_soc_cap
      value = 0
    }
    set_variable = {
      which = pops_not_neutral_soc_cap
      value = 0
    }
    save_event_target_as = country_soc_cap

    # Count Fanatic socialisms
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_socialism }
      event_target:country_soc_cap = {
        change_variable = {
          which = pops_fanatic_socialism
          value = 1
        }
        change_variable = {
          which = total_socialisms
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_soc_cap
          value = 1
        }
      }
    }
    # Count socialisms
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_socialism }
      event_target:country_soc_cap = {
        change_variable = {
          which = pops_socialism
          value = 1
        }
        change_variable = {
          which = total_socialisms
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_soc_cap
          value = 1
        }
      }
    }
    # Count capitalisms
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_capitalism }
      event_target:country_soc_cap = {
        change_variable = {
          which = pops_capitalism
          value = 1
        }
        change_variable = {
          which = total_capitalisms
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_soc_cap
          value = 1
        }
      }
    }
    # Count Fanatic capitalisms
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_capitalism }
      event_target:country_soc_cap = {
        change_variable = {
          which = pops_fanatic_capitalism
          value = 1
        }
        change_variable = {
          which = total_capitalisms
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_soc_cap
          value = 1
        }
      }
    }
    # Count neutrals
    every_owned_pop = {
      limit = {
        NOR {
          pop_has_ethic = ethic_fanatic_socialism
          pop_has_ethic = ethic_socialism
          pop_has_ethic = ethic_capitalism
          pop_has_ethic = ethic_fanatic_capitalism
        }
      }
      event_target:country_soc_cap = {
        change_variable = {
          which = pops_neutral_soc_cap
          value = 1
        }
      }
    }

    # If not neutrals > neutrals
    if {
      limit = {
        check_variable = {
          which = pops_not_neutral_soc_cap
          value > pops_neutral_soc_cap
        }
      }
      # If socialisms > capitalisms
      if = {
        limit = {
          check_variable = {
            which = total_socialisms
            value > total_capitalisms
          }
        }
        # If fanatics > moderates
        if = {
          limit = {
            check_variable = {
              which = pops_fanatic_socialism
              value > pops_socialism
            }
          }
          country_event = { id = tyranny_majority.50 }
          else = {
            country_event = { id = tyranny_majority.51 }
          }
        }
        # If capitalisms > socialisms
        else = {
          # If fanatics > moderates
          if = {
            limit = {
              check_variable = {
                which = pops_fanatic_capitalism
                value > pops_capitalism
              }
            }
            country_event = { id = tyranny_majority.53 }
            else = {
              country_event = { id = tyranny_majority.52 }
            }
          }
        }
      }
      else {
        country_event = { id = tyranny_majority.54 }
      }
    }
  }
}

### Compare Ecological-Industrial axis

country_event = {
  id = tyranny_majority.600

  is_triggered_only = yes
  hide_window = yes

  immediate = {
    set_variable = {
      which = pops_fanatic_green
      value = 0
    }
    set_variable = {
      which = pops_green
      value = 0
    }
    set_variable = {
      which = total_greens
      value = 0
    }
    set_variable = {
      which = pops_industrial
      value = 0
    }
    set_variable = {
      which = pops_fanatic_industrial
      value = 0
    }
    set_variable = {
      which = total_industrials
      value = 0
    }
    set_variable = {
      which = pops_neutral_env
      value = 0
    }
    set_variable = {
      which = pops_not_neutral_env
      value = 0
    }
    save_event_target_as = country_env

    # Count Fanatic greens
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_green }
      event_target:country_env = {
        change_variable = {
          which = pops_fanatic_green
          value = 1
        }
        change_variable = {
          which = total_greens
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_env
          value = 1
        }
      }
    }
    # Count greens
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_green }
      event_target:country_env = {
        change_variable = {
          which = pops_green
          value = 1
        }
        change_variable = {
          which = total_greens
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_env
          value = 1
        }
      }
    }
    # Count industrials
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_industrial }
      event_target:country_env = {
        change_variable = {
          which = pops_industrial
          value = 1
        }
        change_variable = {
          which = total_industrials
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_env
          value = 1
        }
      }
    }
    # Count Fanatic industrials
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_industrial }
      event_target:country_env = {
        change_variable = {
          which = pops_fanatic_industrial
          value = 1
        }
        change_variable = {
          which = total_industrials
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_env
          value = 1
        }
      }
    }
    # Count neutrals
    every_owned_pop = {
      limit = {
        NOR {
          pop_has_ethic = ethic_fanatic_green
          pop_has_ethic = ethic_green
          pop_has_ethic = ethic_industrial
          pop_has_ethic = ethic_fanatic_industrial
        }
      }
      event_target:country_env = {
        change_variable = {
          which = pops_neutral_env
          value = 1
        }
      }
    }

    # If not neutrals > neutrals
    if {
      limit = {
        check_variable = {
          which = pops_not_neutral_env
          value > pops_neutral_env
        }
      }
      # If greens > industrials
      if = {
        limit = {
          check_variable = {
            which = total_greens
            value > total_industrials
          }
        }
        # If fanatics > moderates
        if = {
          limit = {
            check_variable = {
              which = pops_fanatic_green
              value > pops_green
            }
          }
          country_event = { id = tyranny_majority.60 }
          else = {
            country_event = { id = tyranny_majority.61 }
          }
        }
        # If industrials > greens
        else = {
          # If fanatics > moderates
          if = {
            limit = {
              check_variable = {
                which = pops_fanatic_industrial
                value > pops_industrial
              }
            }
            country_event = { id = tyranny_majority.63 }
            else = {
              country_event = { id = tyranny_majority.62 }
            }
          }
        }
      }
      else {
        country_event = { id = tyranny_majority.64 }
      }
    }
  }
}

### Compare Expansionist-Isolationist axis

country_event = {
  id = tyranny_majority.700

  is_triggered_only = yes
  hide_window = yes

  immediate = {
    set_variable = {
      which = pops_fanatic_expansionist
      value = 0
    }
    set_variable = {
      which = pops_expansionist
      value = 0
    }
    set_variable = {
      which = total_expansionists
      value = 0
    }
    set_variable = {
      which = pops_isolationist
      value = 0
    }
    set_variable = {
      which = pops_fanatic_isolationist
      value = 0
    }
    set_variable = {
      which = total_isolationists
      value = 0
    }
    set_variable = {
      which = pops_neutral_exp_iso
      value = 0
    }
    set_variable = {
      which = pops_not_neutral_exp_iso
      value = 0
    }
    save_event_target_as = country_exp_iso

    # Count Fanatic expansionists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_expansionist }
      event_target:country_exp_iso = {
        change_variable = {
          which = pops_fanatic_expansionist
          value = 1
        }
        change_variable = {
          which = total_expansionists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_exp_iso
          value = 1
        }
      }
    }
    # Count expansionists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_expansionist }
      event_target:country_exp_iso = {
        change_variable = {
          which = pops_expansionist
          value = 1
        }
        change_variable = {
          which = total_expansionists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_exp_iso
          value = 1
        }
      }
    }
    # Count isolationists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_isolationist }
      event_target:country_exp_iso = {
        change_variable = {
          which = pops_isolationist
          value = 1
        }
        change_variable = {
          which = total_isolationists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_exp_iso
          value = 1
        }
      }
    }
    # Count Fanatic isolationists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_isolationist }
      event_target:country_exp_iso = {
        change_variable = {
          which = pops_fanatic_isolationist
          value = 1
        }
        change_variable = {
          which = total_isolationists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_exp_iso
          value = 1
        }
      }
    }
    # Count neutrals
    every_owned_pop = {
      limit = {
        NOR {
          pop_has_ethic = ethic_fanatic_expansionist
          pop_has_ethic = ethic_expansionist
          pop_has_ethic = ethic_isolationist
          pop_has_ethic = ethic_fanatic_isolationist
        }
      }
      event_target:country_exp_iso = {
        change_variable = {
          which = pops_neutral_exp_iso
          value = 1
        }
      }
    }

    # If not neutrals > neutrals
    if {
      limit = {
        check_variable = {
          which = pops_not_neutral_exp_iso
          value > pops_neutral_exp_iso
        }
      }
      # If expansionists > isolationists
      if = {
        limit = {
          check_variable = {
            which = total_expansionists
            value > total_isolationists
          }
        }
        # If fanatics > moderates
        if = {
          limit = {
            check_variable = {
              which = pops_fanatic_expansionist
              value > pops_expansionist
            }
          }
          country_event = { id = tyranny_majority.70 }
          else = {
            country_event = { id = tyranny_majority.71 }
          }
        }
        # If isolationists > expansionists
        else = {
          # If fanatics > moderates
          if = {
            limit = {
              check_variable = {
                which = pops_fanatic_isolationist
                value > pops_isolationist
              }
            }
            country_event = { id = tyranny_majority.73 }
            else = {
              country_event = { id = tyranny_majority.72 }
            }
          }
        }
      }
      else {
        country_event = { id = tyranny_majority.74 }
      }
    }
  }
}

### Elitarian - Egalitarian axis

country_event = {
  id = tyranny_majority.800

  is_triggered_only = yes
  hide_window = yes

  immediate = {
    set_variable = {
      which = pops_fanatic_elitist
      value = 0
    }
    set_variable = {
      which = pops_elitist
      value = 0
    }
    set_variable = {
      which = total_elitists
      value = 0
    }
    set_variable = {
      which = pops_pluralist
      value = 0
    }
    set_variable = {
      which = pops_fanatic_pluralist
      value = 0
    }
    set_variable = {
      which = total_pluralists
      value = 0
    }
    set_variable = {
      which = pops_neutral_eli_plu
      value = 0
    }
    set_variable = {
      which = pops_not_neutral_eli_plu
      value = 0
    }
    save_event_target_as = country_eli_plu

    # Count Fanatic elitists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_elitist }
      event_target:country_eli_plu = {
        change_variable = {
          which = pops_fanatic_elitist
          value = 1
        }
        change_variable = {
          which = total_elitists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_eli_plu
          value = 1
        }
      }
    }
    # Count elitists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_elitist }
      event_target:country_eli_plu = {
        change_variable = {
          which = pops_elitist
          value = 1
        }
        change_variable = {
          which = total_elitists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_eli_plu
          value = 1
        }
      }
    }
    # Count pluralists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_pluralist }
      event_target:country_eli_plu = {
        change_variable = {
          which = pops_pluralist
          value = 1
        }
        change_variable = {
          which = total_pluralists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_eli_plu
          value = 1
        }
      }
    }
    # Count Fanatic pluralists
    every_owned_pop = {
      limit = { pop_has_ethic = ethic_fanatic_pluralist }
      event_target:country_eli_plu = {
        change_variable = {
          which = pops_fanatic_pluralist
          value = 1
        }
        change_variable = {
          which = total_pluralists
          value = 1
        }
        change_variable = {
          which = pops_not_neutral_eli_plu
          value = 1
        }
      }
    }
    # Count neutrals
    every_owned_pop = {
      limit = {
        NOR {
          pop_has_ethic = ethic_fanatic_elitist
          pop_has_ethic = ethic_elitist
          pop_has_ethic = ethic_pluralist
          pop_has_ethic = ethic_fanatic_pluralist
        }
      }
      event_target:country_eli_plu = {
        change_variable = {
          which = pops_neutral_eli_plu
          value = 1
        }
      }
    }

    # If not neutrals > neutrals
    if {
      limit = {
        check_variable = {
          which = pops_not_neutral_eli_plu
          value > pops_neutral_eli_plu
        }
      }
      # If elitists > pluralists
      if = {
        limit = {
          check_variable = {
            which = total_elitists
            value > total_pluralists
          }
        }
        # If fanatics > moderates
        if = {
          limit = {
            check_variable = {
              which = pops_fanatic_elitist
              value > pops_elitist
            }
          }
          country_event = { id = tyranny_majority.80 }
          else = {
            country_event = { id = tyranny_majority.81 }
          }
        }
        # If pluralists > elitists
        else = {
          # If fanatics > moderates
          if = {
            limit = {
              check_variable = {
                which = pops_fanatic_pluralist
                value > pops_pluralist
              }
            }
            country_event = { id = tyranny_majority.83 }
            else = {
              country_event = { id = tyranny_majority.82 }
            }
          }
        }
      }
      else {
        country_event = { id = tyranny_majority.84 }
      }
    }
  }
}
